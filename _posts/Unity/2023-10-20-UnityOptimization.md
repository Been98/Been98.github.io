---
title : "유니티 최적화 정리"
excerpt : "유튜브에 있는 Unity Korea의 모바일 게임 최적화 "

categories:
    - Unity
    
tags:
    - Blog
last_modified_at : 2023-10-20
---

프로파일링 - 최적화 하기 전에 프로파일링을 해야함 
프로파일러는 누가 하는가 ? 프로그래머가 주 책임자이다. 
프로그래머가 먼저 프로파일링을 하고 그 후에 TA나 그래픽팀에서 작업을 하는게 좋다.

프로파일할 때 출시 직전에 최적화를 진행하기 x 

프로파일링은 분기에 1번 씩 주기적으로 진행
또 타겟 디바이스에서 진행을 해봐야한다.
에디터에서 돌리는 프로파일링은 부정확함
모바일 기기 성능이랑 pc성능이랑 다른 것 처럼 꼭 타겟 디바이스로 진행 (xCode로 진행하면 좋음)

fps로 판단하기에는 병목측정하기에는 힘들다. ms(밀리세컨드)로 병목 판단하기 (fps = 1000/ms, ms = 1000/fps)

병목이 cpu바운더리인지 gpu 인지 체크 꼭 하기 

디바이스 온도 체크하기 
모바일은 열이 오르면 성능을 떨구기(쓰로틀링) 때문에 두 상황 다 책정해야함 

해상도에 따라서 병목 위치가 달라질 수 있음 따라서 주 타겟층을 생각해서 해야함

메모리 
모바일에서는 메모리를 타이트하게 써야한다. 넘으면 터짐
C++에서는 Delete가 있지만 C#에서는 GC를 사용 
GC가 호출하면서 메모리 재배치등 진행하면서 메모리 압축을 하는데 연산에 문제가 있다. 프레임이 살짝씩 튈 때는 GC가 문제일 경우가 많으니 new를 많이 하거나 메모리 할당을 많이 하면 안된다.


------ 코딩

애니메이션에서 m_Animator.SetBool("Jump", true);
이 코드에서 string을 직접 입력하는건 GC를 계속 사용하게 됨 따라서 파라미터에 ID를 입력하는게 효율적임 (한 두번은 당연히 상관없음)

코루틴 yield retrun new wati~~ 에서 new가 계속 발생하기에 GC가 생김 따라서 캐싱을 해야한다.

생명주기 다시 보기
실행 순서를 잘 알아야 성능을 관리하기 편하다
#if UNITY_EDITOR 함수(){} #endif 이렇게 에디터에서 사용하는 함수는 릴리즈에 사용이 안됨 
Debug.Log는 빌드하면 사라지는게 아니니 꼭 삭제 하거나 System.Diagnostics.Conditional("ENABLE_LOG")를 사용해서 디버그를 막자

컴포넌트를 실시간으로 붙혔다 제거하는 행위는 성능을 많이 먹는다. ex) 몬스터별로 컴포넌트를 다르게 스크립트를 통해서 제어하는게 아니라 각각의 몬스터를 프리팹으로 만들어서 사용하자

Find, GetComponent, Camera.main은 update가 아닌 start에서 사용하는걸 권장한다.

오브젝트 풀은 꼭 사용하자

유니티 버전마다 부모를 재설정하는 비용이 다르긴 하지만 되도록 사용하지 말자 (하이어라키창에서 보기 안 좋더라도 그냥 마음을 비우고 하자)

스크랩터블 오브젝트는 유니티 튜토리얼에서 알려주니까 꼭 해보자

---
프로젝트 설정창 

안 쓰거나 필요없는건 대부분 꺼라
Auto Graphics API(OpenGl 2나3를 사용하면 벌칸을 끄자 반대상황도)

물리연산은 FixedUpdate에서 다루자 (사용하지 않으면 설정에서 다 끄자  Auto Simulation, Auto Sync Transform)

FrameRate정책을 만들어 구현하는게 좋다.

하이어라키창에서 자식이 많으면 많을수록 부모를 움직일 때 자식 모두가 움직이게 되니까 연산이 많이 들어간다. 이것도 생각해서 구현하자

또 a,b,c오브젝트가 서로 종속관계가 아니라면 멀티 스레드를 활용해서 연산을 할 수 있다. 

따라서 하이어라키는 간단하게 할수록 이득을 본다.

여러 스크립트에서 트랜스폼을 건들이면 안 좋기에 고려하자
ex) Player에 Move.cs, Jump.cs, Dash.cs, Dodge.cs 4스크립트 모두 트랜스폼을 사용

핸드폰에서는 V Sync(수직동기화)를 자동으로 켜주니 그냥 킨다고 생각하는게 좋다.

Assets 

JPG, PNG, PSD, PSB등 어떤 포멧을 가져와도 유니티에서 포멧을 재변환하기에 어떤 포멧을 가져와도 똑같으니 관리하기 편한(포토샵 작업 후 PNG로 변환하기 번거롭기 때문에) PSD, PSB를 쓰자





